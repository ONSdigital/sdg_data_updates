### 3-9-2 automation ###
  
This automation pulls together all relevant ICD-10 classification codes
from the UN metadata https://unstats.un.org/sdgs/metadata/files/Metadata-03-09-02.pdf
off NOMIS to display their mortality rate per 100,000 disaggregated by 
country, region, sex, and type of disease.
  
### Instructions to run update ###
1. *UK SDG data team:* Go to Jemalex > sdg_data_updates.    
   *Others:* Checkout sdg_data_updates main branch to your local repository.     
2. Open sdg_data_updates.Rproj
3. Change indicator folder name (indicator <- "3-9-2")
4. If config.R does not exist in the 3-9-2 folder, create it from the example_config.R file
5. Check the configs are correct. In particular, check the years variable as the latest year will likely need to be     added when running an update. The nomis links should not need to be edited, unless you want to add or remove ICD-10 classification codes following UN or Topic Expert guidance.
6. Open update_indicator_main.R .
7. Ensure test_run <- FALSE.
8. Click Source (by default this is in top right of the script window)
9. Check for messages in the console. When the script is run a file titled '3-9-2.csv' will be saved in 3-9-2 > Output Use this file for the Indicator csv.
10. A file called 3-9-2_checks.html will also be in the outputs folder. Read through this as a QA of the csv.


### Instructions for metadata ###
The last updated date is not generated by the script. However you can get this from the bottom of the review selections section
on Nomis for [*mortality statistics*](https://www.nomisweb.co.uk/api/v01/dataset/NM_161_1.data.csv?geography=2092957699,2092957700,2013265926,2013265924,2013265927,2013265921,2013265922,2013265928,2013265929,2013265925,2013265923&cause_of_death=0,10100,10101,10103,10104,10106...10109,10276,10277,10279,590,10865,10866,1100,1110,1120,11623&gender=0...2&age=0&measure=1&measures=20100) and
[population](https://www.nomisweb.co.uk/api/v01/dataset/NM_31_1.data.csv?geography=2092957699,2092957703,2092957698,2092957702,2092957701,2092957697,2092957700,2013265926,2013265924,2013265927,2013265921,2013265922,2013265928,2013265929,2013265925,2013265923&date=latestMINUS8-latest&sex=5...7&age=0&measures=20100).  
    

### Generation of nomis links ###
The nomis links should not need to be regenerated unless we decide to change underlying cause selections or alter other dissagregations. If nomis is being used without an account, the downloaded dataset is cropped at 25000 rows. Link generation will depend on whether you are using an account. It is suggested to ensure you are signed into a NOMIS, but the code is set up for where this is not the case.

The current nomis links were generated as follows:

#### Mortality rate numbers ####
From Nomis, select Query > Life Events > Mortality statistics - underlying cause, sex and age.   
  
Selections:
   countries: England, Wales
   Regions: All except the devolved countries
   Date: All years
   Age: Total (all ages)
   Rates: Deaths
   Sex: All
   Underlying Cause: Full ICD-10 Classification > 
        diarrhoea A00, A01, A03, A04, A06-A09;
        acute respiratory infections H65-H66, J00-J22, P23, and U04;
        intestinal nematode infections B76-B77, and B79;
        protein-energy malnutrition E40-E46.
  

To generate link go to format/layout and select API. Then in 'Download data' right click on the csv link and copy link
Check last updated date [here](https://www.nomisweb.co.uk/query/construct/summary.asp?mode=construct&version=0&dataset=161)

#### population size ####
From Nomis, select Query, then Population estimates/Projections > population estimates - local authority based by 5 year age band
Selections:
   countries: All
   Regions: All except the devolved countries
   Date: All years where have mortality statistics (Feb 2023 this was 2013-2021)
   Age: total (no age breakdown))
   Percent: Off
   Sex: All


To generate link go to format/layout and select API. Then in 'Download data' right click on the csv link and copy link
Check last updated date [here](https://www.nomisweb.co.uk/query/construct/summary.asp?mode=construct&version=0&dataset=31)  
  

  
### Code edits that may be needed: ###  
*use this section for any problems or changes you can foresee*
  
