---
title: "8.3.1_test"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(tidyverse)
library(knitr)
library(kableExtra)

eightthreeone_csv <- read_csv("D:\\Coding_repos\\sdg_data_updates\\8-3-1\\output\\8-3-1_csv_2021-05-10.csv") 





# only want to create this df only when there are suppressed Country values otherwise I would be creating an empty df

################

sector_by_country_na <- eightthreeone_csv %>%
  filter(is.na(Sector) & is.na(Region)& is.na(Sex)) %>% 
  mutate(Country = ifelse(is.na(Country), "United Kingdom", Country),
         Sector = ifelse(is.na(Sector), "Total", Sector))

sector_by_country_na2 <- eightthreeone_csv %>%
  filter(!is.na(Sector) & is.na(Country) & is.na(Region) & is.na(Sex)) %>% 
  mutate(Country = "United Kingdom")
  
  
sector_by_country <- eightthreeone_csv %>%
  select(Year, Country, Sector, Value) %>% 
  filter(!is.na(Sector)& !is.na(Country)) %>% 
  bind_rows(sector_by_country_na, sector_by_country_na2)


sector_by_region <- eightthreeone_csv %>%
  filter(is.na(Country) & is.na(Sex) & !is.na(Region)) %>% 
  mutate(Sector = ifelse(is.na(Sector), "Total", Sector))

sector_by_sex <- eightthreeone_csv %>% 
  filter(is.na(Country) & is.na(Region)) %>% 
  mutate(Sex = ifelse(is.na(Sex), "Total", Sex),
         Sector = ifelse(is.na(Sector), "Total", Sector))


country_by_sex <- eightthreeone_csv %>% 
  filter(is.na(Region) & is.na(Sector)) %>% 
  mutate(Sex = ifelse(is.na(Sex), "Total", Sex),
         Country = ifelse(is.na(Country), "Total", Country))


suppressed_sector_by_region <- suppressed_values %>% 
  filter(Region != "")

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


## Sector by Country plot

The below plot displays the percentage of employed people in informal employment by Country and Sector

```{r sector_by_country, echo=FALSE}

ggplot(sector_by_country, aes(Year, Value))+
  geom_line(color = "steelblue")+
  geom_point(color = "steelblue")+
  labs(title = "Sector by Country",
       y = "Percentage of employed people in informal employment", x = "")+
  facet_grid(Sector ~ Country)+
  theme_bw()+
  theme(axis.text.x = element_text(angle = -45, vjust = 1, hjust = 0))
  #theme(panel.grid.major = element_line(colour = "black"))

# # only want to create this df only when there are suppressed Country values otherwise I would be creating an empty df
# suppressed_sector_by_country <- suppressed_values %>% 
#   filter(Country != "")
# if (nrow(country_suppressed) > 0) {
#   print(suppressed_sector_by_country)
# } else {print("No suppressed values for this plot")}

```

```{r sector_by_country table, echo=FALSE}
suppressed_sector_by_country <- suppressed_values %>% 
  filter(Country != "")
if (nrow(suppressed_sector_by_country) > 0) {
  print(suppressed_sector_by_country)
} else {
  print("This dissaggregation had no suppressed values")
}

```

## Sector by Region plot

The below plot displays the percentage of employed people in informal employment by Sector and Region



```{r sector_by_region, echo=FALSE}

ggplot(sector_by_region, aes(Year, Value))+
  geom_line(color = "steelblue")+
  geom_point(color = "steelblue")+
  labs(title = "Sector by region",
       y = "Percentage of employed people in informal employment", x = "")+
  facet_grid(Sector ~ Region)+
  theme(axis.text.x = element_text(angle = -45, vjust = 1, hjust = 0))+
  theme(panel.grid.major = element_line(colour = "black"))


```

```{r sector_by_region table, echo=FALSE, results = 'hold'}
#knitr::opts_chunk$set(error = TRUE)


if (nrow(suppressed_sector_by_region) > 0) {
  kable(suppressed_sector_by_region, format="html", booktabs=TRUE) %>% 
    kable_styling(bootstrap_options="basic")
} else {
  print("This dissaggregation had no suppressed values")
}


```

## Sector by Sex plot

The below plot displays the percentage of employed people in informal employment by Sector and Sex




```{r sector_by_sex, echo=FALSE}

ggplot(sector_by_sex, aes(Year, Value))+
  geom_line(color = "steelblue")+
  geom_point(color = "steelblue")+
  labs(title = "Sector by sex",
       y = "Percentage of employed people in informal employment", x = "")+
  facet_grid(Sector ~ Sex)+
  theme(axis.text.x = element_text(angle = -45, vjust = 1, hjust = 0))+
  theme(panel.grid.major = element_line(colour = "black"))



```
```{r sector_by_sex table, echo=FALSE}
suppressed_sector_by_sex <- suppressed_values %>% 
  filter(Sex != "")
if (nrow(suppressed_sector_by_sex) > 0) {
  print(suppressed_sector_by_sex)
} else{
  print("This dissaggregation had no suppressed values")
}
```


## Country by Sex plot

The below plot displays the percentage of employed people in informal employment by Country and Sex



```{r country_by_sex, echo=FALSE}

ggplot(country_by_sex, aes(Year, Value))+
  geom_line(color = "steelblue")+
  geom_point(color = "steelblue")+
  labs(title = "Country by sex",
       y = "Percentage of employed people in informal employment", x = "")+
  facet_grid(Sex ~ Country)+
  theme(axis.text.x = element_text(angle = -45, vjust = 1, hjust = 0))+
  theme(panel.grid.major = element_line(colour = "black"))


```
```{r country_by_sex table, echo=FALSE}
suppressed_Country_by_sex <- suppressed_values %>% 
  filter(Country != "" & Sex != "")
if (nrow(suppressed_Country_by_sex) > 0) {
  kable(print(suppressed_Country_by_sex))
} else{
  print("This dissaggregation had no suppressed values")
}
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
