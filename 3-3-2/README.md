### 3-3-2 automation
  
This automation reads in data from two sources for indicator 3-3-2, one for the UK and one for England. This one is quite tricky as the most recent data is only available in pdf format; excel workbooks are only available for England data prior to 2019. 
Due to the fact that pdf formats are much more liable to change I HAVE ATTEMPTED TO PUT MULTIPLE OPTIONS IN FOR READING IN THE DATA:
1. Using PDE package to read in pdf
2. The user copy and pastes data from the pdf into an excel workbook (for if the above method doesn't work)
There will be an option in the config to select which of these the program does
  
### Instructions to run update ###
1. *UK SDG data team:* (once this code has been reviewed and is on the main branch) Go to Jemalex > sdg_data_updates.    
   *Others:* Checkout sdg_data_updates main branch to your local repository.     
2. Open sdg_data_updates.Rproj  
3. Change indicator folder name (`indicator <- "x-x-x"`)  
4. If config.R does not exist in the x-x-x folder, create it from the example_config.R file  
5. Check the configs are correct. The nomis links should not need to be edited, unless you want to add or remove occupation codes. 
To run the example data and get example output, it should be example_config.R).   
6. Open update_indicator_main.R  
7. Click Source (by default trhis is in top right of the script window)  
8. Check for messages in the console. When the script is run a file titled 'x-x-x.csv' will be saved in x-x-x > Output 
   Use this file for the Indicator csv.  
10. A file called <date>_x-x-x_checks.html will also be in the outputs folder. Read through this as a QA of the csv.  

### Instructions for metada ###
The last updated date is not generated by the script. However you can get this from the bottom of the review selections section
on Nomis for [*short description of data*](nomis link used in the configs) and
[population](https://www.nomisweb.co.uk/query/construct/summary.asp?mode=construct&version=0&dataset=31).  
    
*note: check the population link when census 2021 numbers are out.*
  
### Generation of nomis links ###
The nomis links should not need to be regenerated unless we decide to to e.g. change the selected occupation codes  
or use a different population estimate (e.g. when the new estimates from census 2021 are out).  
The current nomis links were generated as follows:

#### health worker numbers ####
From Nomis, select Query, then Annual Population Survey/Labour Force Survey >  annual population survey - regional - employment by occupation   
  
Selections:
   countries: England, Scotland, Northern Ireland, Wales, United Kingdom
   regions: all except the devolved countries
   occupations: deselect any auto ticks. Select 221, 222, 223, 321, and all the 4-digit codes under these
   sex: all ONLY (see note below)
   date: depends on whether it is a normal update or a full backseries run (e.g. if need to use new population figure)
         for normal update: select dates between - the most recent 8 dates, QUARTERLY 
         for back series data: select individual dates (select all December dates - equivalent of ANNUAL)

To generate link go to format/layout and select API. Then in 'Download data' right click on the csv link and copy link
Check last updated date [here](https://www.nomisweb.co.uk/query/construct/summary.asp?mode=construct&version=0&dataset=168)

#### population size ####
From Nomis, select Query, then Population estimates/Projections > population estimates - local authority based by 5 year age band  
To generate link go to format/layout and select API. Then in 'Download data' right click on the csv link and copy link
Check last updated date [here](https://www.nomisweb.co.uk/query/construct/summary.asp?mode=construct&version=0&dataset=31)  
  
*note: check this link when census 2021 numbers are out.*  
  
### Code edits that may be needed: ###  
*use this section for any problems or changes you can foresee*

If PDE doesn't work, maybe need this dependency:
`PDE_install_Xpdftools4.02()    # Download and install the Xpdf command line tools
PDE_check_Xpdf_install()        # Check if all required XPDF tools are installed correctly`

PDE::PDE_install_Xpdftools4.02()
Do you want to download and install xpdf version 4.02? (y/n) 

1: Y
2: N
